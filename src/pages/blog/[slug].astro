---
import MainLayout from "../../layouts/MainLayout.astro";
import { getCollection, getEntryBySlug } from "astro:content";

export async function getStaticPaths() {
  const entries = await getCollection("blog");

  return entries.map((entry) => ({
    params: { slug: entry.slug },
  }));
}

const { slug } = Astro.params;

if (!slug) {
  throw new Error("Missing blog slug");
}

const entry = await getEntryBySlug("blog", slug);

if (!entry) {
  return Astro.redirect("/blog");
}

const { Content } = await entry.render();
const description = entry.data.description ?? "Blog and Notes";
const title = `${entry.data.title} - Blog`;
---
<MainLayout {title} {description}>
  <article class="post-detail">
    <h1>{entry.data.title}</h1>
    {entry.data.description && <p class="post-description">{entry.data.description}</p>}
    <img src={entry.data.imageUrl} alt={entry.data.title} />
    <div class="markdown">
      <Content />
    </div>
  </article>
</MainLayout>
